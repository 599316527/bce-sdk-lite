(function(e){function t(t){for(var r,o,i=t[0],s=t[1],u=t[2],f=0,d=[];f<i.length;f++)o=i[f],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&d.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);l&&l(t);while(d.length)d.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={app:0},c=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var l=s;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("85ec"),a=n.n(r);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("h1",[e._v("BosClient.putObjectFromBlob()")]),n("div",[n("input",{attrs:{type:"file",disabled:e.isUploading},on:{change:e.handleFileChange}}),n("button",{attrs:{disabled:!e.file||e.isUploading},on:{click:e.handleUploadButtonClick}},[e._v("Upload")]),e.file&&e.isUploading?n("button",{on:{click:e.handleCancelButtonClick}},[e._v("Cancel")]):e._e()]),e.isUploading?n("div",{staticClass:"loading"},[e._v("上传中 "+e._s(e.progressText))]):e._e(),e.isFail?n("div",{staticClass:"error"},[e._v("上传失败："+e._s(e.error))]):e._e(),e.isSuccess?n("div",{staticClass:"success"},[e._v("上传成功! "),n("a",{attrs:{href:e.url,target:"_blank"}},[e._v("打开")])]):e._e()])},c=[],o=(n("99af"),n("caad"),n("baa5"),n("c0b6"),n("b0c0"),n("96cf"),n("1da1")),i=n("e1bd"),s=(n("a15b"),n("13d5"),n("6eba"),n("accc"),n("0d03"),n("ac1f"),n("5319"),n("3835")),u=n("d4ec"),l=n("bee2"),f=n("262e"),d=n("2caf"),p=n("e1ed"),h=n.n(p),b=n("3708"),v=n.n(b),g=n("818e"),j=n.n(g),m=n("3447"),k=n.n(m),y=n("c4ce"),O=n.n(y),w=n("f247"),_=n.n(w),C=n("a033"),x=n.n(C),T=n("8130"),R=n.n(T),q=(n("d81d"),n("4e82"),n("b64b"),n("1276"),n("498a"),n("d72d")),P=n.n(q),S=(n("fb6a"),n("c19f"),n("ace4"),n("d3b7"),n("25f0"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("270f"));function U(e){return("0"+e.toString(16)).slice(-2)}function E(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0,a=e.length;r<a;r++)n[r]=e.charCodeAt(r);return n}function z(e){return e.reduce((function(e,t){return e+U(t)}),"")}function A(e,t){var n=Object(S["hmac"])(E(e),E(t));return z(n)}var D="Content-Type",B="Content-Length",F="Content-MD5",M="Content-Encoding",I="Content-Disposition",$="ETag",L="Host",Z="Cache-Control",H="Expires",N="Authorization",J="x-bce-date",Q="x-bce-acl",X="x-bce-grant-read",G="x-bce-grant-full-control",K="x-bce-content-sha256",V="x-bce-object-acl",W="x-bce-object-grant-read",Y="http_headers",ee="body",te="status_code",ne="message",re="code",ae="x-bce-security-token",ce={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A"};function oe(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=encodeURIComponent(e);return n=n.replace(/[!'\(\)\*]/g,(function(e){return ce[e]})),t||(n=n.replace(/%2F/gi,"/")),n}function ie(e){return new Blob([e]).size}function se(e){var t=e.split("/"),n=0,r=t.reduce((function(e,t){return t=t.trim(),/^\.{2,}$/.test(t)?n=Math.max(0,n-1):t&&"."!==t&&(e[n++]=t),e}),[]);return r=r.slice(0,n),"/".concat(r.join("/"))}var ue=[L,F,B,D],le=function(){function e(t,n){Object(u["a"])(this,e),this.ak=t,this.sk=n}return Object(l["a"])(e,[{key:"generateAuthorization",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Date,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1800,o=arguments.length>6?arguments[6]:void 0,i=["bce-auth-v1",this.ak,a.toISOString().replace(/\.\d+Z$/,"Z"),c].join("/"),u=A(this.sk,i),l=this.uriCanonicalization(t),f=this.queryStringCanonicalization(n||{}),d=this.headersCanonicalization(r||{},o),p=Object(s["a"])(d,2),h=p[0],b=p[1],v=[e,l,f,h].join("\n"),g=A(u,v);return[i,b.join(";"),g].join("/")}},{key:"uriCanonicalization",value:function(e){return e}},{key:"queryStringCanonicalization",value:function(e){var t=Object.keys(e).reduce((function(t,n){if(n.toLowerCase()===N.toLowerCase())return t;var r=null==e[n]?"":e[n];return t.concat(n+"="+oe(r))}),[]);return t.sort().join("&")}},{key:"headersCanonicalization",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ue,n=P()(t.map((function(e){return[e.toLowerCase(),!0]}))),r=k()(e).reduce((function(e,t){var r=Object(s["a"])(t,2),a=r[0],c=r[1];return a=a.toLowerCase(),c=h()(c)?c.trim():c,null===c||""===c||!O()(a,"x-bce-")&&!0!==n[a]?e:e.concat([a,c].map(oe).join(":"))}),[]);r.sort();var a=r.map((function(e){return e.split(":")[0]}));return[r.join("\n"),a]}}]),e}(),fe=(n("c1c3"),n("5530")),de=n("ade3"),pe=n("257e"),he=n("bc3a"),be=n.n(he),ve=(n("4de4"),n("4160"),n("159b"),function(){function e(){Object(u["a"])(this,e),this._events={}}return Object(l["a"])(e,[{key:"on",value:function(e,t){this._events[e]||(this._events[e]=[]),_()(this._events[e],t)||this._events[e].push(t)}},{key:"off",value:function(e,t){this._events[e]=t?this._events[e].filter((function(e){return e!==t})):[]}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=this._events[e]||[];a.forEach((function(e){return e.apply(void 0,n)}))}}]),e}()),ge=function(e){Object(f["a"])(n,e);var t=Object(d["a"])(n);function n(e){var r;return Object(u["a"])(this,n),r=t.call(this),r.config=e,r._client=be.a.create({baseURL:r.config.endpoint,headers:Object(de["a"])({},D,"application/json; charset=UTF-8"),onUploadProgress:r.updateProgress.bind(Object(pe["a"])(r))}),r}return Object(l["a"])(n,[{key:"sendRequest",value:function(e,t,n,r,a,c){e=e.toUpperCase();var o={url:t,method:e,params:a};return o.headers=Object(fe["a"])(Object(fe["a"])({},r),{},Object(de["a"])({},J,(new Date).toISOString().replace(/\.\d+Z$/,"Z"))),o.headers[N]="function"===typeof c?c(this.config.credentials,e,t,a,r):je(this.config.credentials,e,t,a,r),this._doRequest(o,n)}},{key:"_doRequest",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,c,o,i,s,u,l,f,d,p,h=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._client.request(Object(fe["a"])(Object(fe["a"])({},t),{},{data:n,responseType:"text",cancelToken:new be.a.CancelToken((function(e){h._cancelRequest=e}))}));case 3:r=e.sent,e.next=25;break;case 6:if(e.prev=6,e.t0=e["catch"](0),e.t0.response){e.next=10;break}return e.abrupt("return",Promise.reject(e.t0));case 10:if(a=e.t0.response,c=a.status,o=a.data,i=a.headers,!(c>=100&&c<200)){e.next=15;break}return e.abrupt("return",Promise.reject(ye(c,"Can not handle 1xx http status code.")));case 15:if(!(c<100||c>=300)){e.next=24;break}try{s=Oe(o,i)}catch(b){}if(!s.requestId){e.next=23;break}return u=s,l=u.message,f=u.code,d=u.requestId,e.abrupt("return",Promise.reject(ye(c,l,f,d,i.date)));case 23:return e.abrupt("return",Promise.reject(ye(c,s)));case 24:return e.abrupt("return",Promise.reject(ye(e.t0.response.status,e.t0.message)));case 25:e.prev=25,p=Oe(r.data,r.headers),e.next=32;break;case 29:return e.prev=29,e.t1=e["catch"](25),e.abrupt("return",Promise.reject(ye(r.status,e.t1.message)));case 32:return e.abrupt("return",ke(me(r.headers),p));case 33:case"end":return e.stop()}}),e,this,[[0,6],[25,29]])})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"cancelRequest",value:function(){this._cancelRequest&&this._cancelRequest.apply(this,arguments)}},{key:"updateProgress",value:function(e){this.emit("progress",e)}}]),n}(ve);function je(e,t,n,r,a){var c=new Auth(e.ak,e.sk);return c.generateAuthorization(t,n,r,a)}function me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return k()(e).reduce((function(e,t){var n=Object(s["a"])(t,2),r=n[0],a=n[1];return a=a.trim(),a&&(r=r.toLowerCase(),"etag"===r&&(a=a.replace(/"/g,"")),e[r]=a),e}),{})}function ke(e,t){var n;return n={},Object(de["a"])(n,Y,e),Object(de["a"])(n,ee,t),n}function ye(e,t,n,r,a){var c,o=(c={},Object(de["a"])(c,te,e),Object(de["a"])(c,ne,t),c);return n&&(o[re]=n),r&&(o[X_REQUEST_ID]=r),a&&(o[J]=a),o}function Oe(e,t){var n=t["content-type"];return e.length?n&&/^(application|text)\/json$/i.test(n)?JSON.parse(e):e:{}}var we=5368709120,_e=2048,Ce=[B,M,F,K,D,I,$,ae,Z,H,Q,X,G,V,W],xe={bucketName:null,key:null,body:null,headers:{},params:{},config:{}},Te=function(e){Object(f["a"])(n,e);var t=Object(d["a"])(n);function n(e){var r;return Object(u["a"])(this,n),r=t.call(this),r.config=e,r}return Object(l["a"])(n,[{key:"createSignature",value:function(e,t,n,r,a){var c=Date.now()+(this.timeOffset||0);a[J]=new Date(c).toISOString().replace(/\.\d+Z$/,"Z");var o=new le(e.ak,e.sk);return o.generateAuthorization(t,n,r,a,new Date(c))}},{key:"generateUrl",value:function(e,t){var n=se(["/v1",oe(e||""),oe(t||"",!1)].join("/"));return this.config.endpoint+n}},{key:"putObject",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!t)throw new TypeError("key should not be empty.");return r=this._checkOptions(r),this.sendRequest("PUT",{bucketName:e,key:t,body:n,headers:r.headers,config:r.config})}},{key:"putObjectFromBlob",value:function(e,t,n,r){var a={};return a[B]=n.size,r=v()({},a,r),this.putObject(e,t,n,r)}},{key:"sendRequest",value:function(e,t){var n=v()({},xe,t),r=v()({},this.config,n.config),a=se(["/v1",/\.[\w\-]+\.bcebos\.com$/.test(r.endpoint)?"":oe(n.bucketName||""),oe(n.key||"",!1)].join("/"));return r.sessionToken&&(n.headers[ae]=r.sessionToken),this.sendHTTPRequest(e,a,n,r)}},{key:"sendHTTPRequest",value:function(e,t,n,r){var a=this,c={httpMethod:e,resource:t,args:n,config:r},o=function(){var o=new ge(r);o.on("progress",(function(e){return a.emit("progress",e,c)})),a.cancelRequest=o.cancelRequest.bind(o);var i=o.sendRequest(e,t,n.body,n.headers,n.params,a.createSignature.bind(a));return i.abort=a.cancelRequest,i};return o()["catch"]((function(e){var t=new Date(e[J]).getTime();if(a.timeOffset=t-Date.now(),403===e[te]&&"RequestTimeTooSkewed"===e[re])return o();throw h()(e.message)||(e.message="Unknown error. (".concat(e[te],")")),e}))}},{key:"_checkOptions",value:function(e,t){return{config:e.config||{},headers:this._prepareObjectHeaders(e),params:R()(e,t||[])}}},{key:"_prepareObjectHeaders",value:function(e){var t=x()(e,(function(e,t){return _()(Ce,t)||O()(t,"x-bce-meta-")})),n=k()(t).reduce((function(e,t){var n=Object(s["a"])(t,2),r=n[0],a=n[1];return O()(r,"x-bce-meta-")?e+ie(r+""+a):e}),0);if(n>_e)throw new TypeError("Metadata size should not be greater than ".concat(_e,"."));if(j()(t,B)){var r=t[B];if(r<0)throw new TypeError("content_length should not be negative.");if(r>we)throw new TypeError("Object length should be less than ".concat(we,". Use multi-part upload instead."))}if(j()(t,"ETag")){var a=t.ETag;/^"/.test(a)||(t.ETag='"'.concat(a,'"'))}return j()(t,D)||(t[D]="application/octet-stream"),t}}]),n}(ve),Re="2e34b3038f1e43f7ab23637467cc94d6",qe="22104041d4754bee8a48712736e68bdd",Pe=void 0,Se="bce-sdk-lite",Ue={name:"App",data:function(){return{file:null,status:0,error:"",progress:0}},computed:{isUploading:function(){return 1===this.status},isFail:function(){return 3===this.status},isSuccess:function(){return 2===this.status},progressText:function(){return Math.round(100*this.progress)+"%"}},methods:{handleFileChange:function(e){this.file=e.target.files[0]},handleUploadButtonClick:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=Ee(e.file.name),r="test/".concat(Object(i["a"])()).concat(n),e.status=1,t.prev=3,t.next=6,e.client.putObjectFromBlob(Se,r,e.file,{"Content-Type":ze(n)});case 6:t.next=14;break;case 8:return t.prev=8,t.t0=t["catch"](3),e.status=3,e.error=t.t0.message,console.log(t.t0),t.abrupt("return");case 14:e.status=2,e.url=e.client.generateUrl(Se,r);case 16:case"end":return t.stop()}}),t,null,[[3,8]])})))()},handleClientProgress:function(e){var t=e.loaded,n=e.total;this.progress=t/n},handleCancelButtonClick:function(){this.client.cancelRequest&&this.client.cancelRequest("User cancelled uploading")}},mounted:function(){var e=new Te({sessionToken:Pe,endpoint:"https://bj.bcebos.com",credentials:{ak:Re,sk:qe}});e.on("progress",this.handleClientProgress.bind(this)),this.client=e},beforeDestroy:function(){this.client.off("progress"),this.cancelRequest&&this.cancelRequest()}};function Ee(e){var t=e.lastIndexOf(".");return t<0?"":e.substring(t)}function ze(e){return[".jpeg",".jpg",".png",".webp",".gif"].includes(e)?"image/".concat(e.substring(1)):[".mp4",".mov"].includes(e)?"video/".concat(e.substring(1)):[".mp3",".m4a",".opus"].includes(e)?"audio/".concat(e.substring(1)):void 0}var Ae=Ue,De=(n("034f"),n("2877")),Be=Object(De["a"])(Ae,a,c,!1,null,null,null),Fe=Be.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(Fe)}}).$mount("#app")},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.bf2369bd.js.map